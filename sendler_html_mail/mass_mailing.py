# -*- coding: utf-8 -*-
import smtplib
import datetime

from email import Utils
from email.header import Header
from email.mime.multipart import MIMEMultipart
from email.mime.application import MIMEApplication
from email.mime.text import MIMEText
from email.MIMEImage import MIMEImage


sender = 'ekaterina.ivanova@wvfs.com'
#receiver = 'ivanesense.frame@gmail.com'
#recipients = ['ivanesense.frame@gmail.com', 'nikita.elkey@gmail.com', 'lukesparamore@gmail.com'] #################
recipients = ['x'] 
#recipients = ['ivanesense@list.ru'] 
subject = "DSecRG test"
fio=['Алексей','Никита','Егор']

a=0

while a<=0:
    msg = MIMEMultipart('related')
    msg['From'] = sender
    #msg['To'] = receiver
    msg['To'] = recipients[a]
    msg['Date']     = Utils.formatdate(localtime = 1)
    msg['Subject'] = Header("Извещение об изменении регламента", "utf-8")
    msg['Message-ID'] = Utils.make_msgid()


    # TEXT_RU
    
    text = u''+' ' ######################
    enc = MIMEText(text.encode('utf-8'), 'plain', 'UTF-8')
    msg.attach(enc)

    # TEXT
    part = MIMEText("")
    msg.attach(part)
    
    #HTML
    html = """<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head><body>
    <div style="font-family:helvetica,helvetica-neue,verdana,arial,sans-serif;width:800px;margin:0 auto;">
    <table border="0" cellpadding="0" cellspacing="0" width="100%" style="border-collapse:collapse;!important;margin:0;padding:0;width:100%!important;">
    <tr>
    <td height="50px">
    <img src="cid:logo" style="margin: 5px 10px;" height="32px" width="300px"/>
    </td>
    <td>
    </td>
    <td align="right">
    <font color="#939598" weight="300"><a href="http://http://wvfs.ru/index.php?id={0}" style="color: #BCBEC0; text-decoration: none; padding: 0px 20px;">Открыть письмо в новом окне</a></font>
    </td>
    </tr>
    <tr style="background-color:#F1F2F2;" height="3px" width="100%">
    <td colspan="3">
    </tr>
    <tr style="background-color:#F1F2F2;" width="100%">
    <td colspan="3">
    <img src="cid:mail" width="100%" align="center"/>
    </td>
    </tr>
    <tr>
    <td colspan="3">
    <font color="#939598" size="3">
    <p align="center" style="margin:50px 50px; font-weight:100; line-height:150%;">Уважаемый(-ая) {1}, руководство "Фольксваген Финансовые Услуги РУС" настоятельно просит Вас обратить внимание на изменение правил оформления подачи заявлений на предоставления оплачиваемого отпуска. <br> </p>
        <center><a href="http://wvfs.ru/index.php?id={2}" class="main-button" style="-moz-box-sizing: border-box; -webkit-appearance: none; background: #00c0ff; border: 0; box-sizing: border-box; color: #fff; cursor: pointer; display: inline-block; font-size: 18px; font-style: normal; font-variant: normal; font-weight: 200; height: 40px; line-height: 40px; margin: .25rem 0; outline: 0; text-align: center; text-decoration: none; vertical-align: baseline; white-space: nowrap; padding: 0px 20px; word-break: break-word;">
    Узнать больше об этом</a></center>
    <p align="center" style="margin:50px 50px; font-weight:100; line-height:150%;">
    Для того чтобы подробно ознакомиться с регламентом оформления, пожалуйста <b>внимательно изучите</b> прикрепленную к письму документацию.</p></font>
        <p><b><i><span lang="EN-US" style="font-size:10.0pt;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:#1f497d">Best regards,</span></i></b><span lang="EN-US" style="font-size:12.0pt;font-family:&#39;Times New Roman&#39;,&#39;serif&#39;;color:#1f497d">
    <u></u><u></u></span></p>
    <p style="margin-bottom:12.0pt"><b><i><span lang="EN-US" style="font-size:10.0pt;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:#1f497d">Ekaterina Ivanova<u></u><u></u></span></i></b></p>
    <p><span lang="EN-US" style="font-size:10.0pt">Human Resource office</span><span lang="EN-US" style="font-size:10.0pt;font-family:&#39;Times New Roman&#39;,&#39;serif&#39;"><u></u><u></u></span></p>

    <p><span lang="EN-US" style="font-size:10.0pt">Volkswagen Bank RUS,</span><span lang="EN-US" style="font-size:10.0pt">
    <br>
    </span><span lang="EN-US" style="font-size:10.0pt">117485, Obrucheva 30/1, b.1</span><span lang="EN-US" style="font-size:10.0pt">
    <br>
    </span><span lang="EN-US" style="font-size:10.0pt">Moscow, Russia</span><span lang="EN-US" style="font-size:10.0pt">
    <u></u><u></u></span></p>
    <p style="text-autospace:none"><span lang="EN-US" style="font-size:10.0pt">Phone:&nbsp; +7&nbsp;495&nbsp;775 7557 ex. 1738<u></u><u></u></span></p>
    <p style="text-autospace:none"><span style="font-size:10.0pt;color:#1f497d"><img width="58" height="50" src="cid:mini"></span><span lang="EN-US" style="font-size:10.0pt"><u></u><u></u></span></p>
    </td>
    </tr>
    </tr>
    <img src="http://wvfs.ru/{3}" width="50" height="50"></body></body>
    </html>""" .format(a,fio[a],a,a)

    part2 = MIMEText(html, 'html', "utf-8")
    #part2.add_header('Content-Type: text/html; charset=windows-1251')
    msg.attach(part2)

    # ATTACH 
    part = MIMEApplication(open("D:\\smap\\"+str(a)+".docx","rb").read()) ##################################
    part.add_header('Content-Disposition', 'attachment', filename='new_reglament.docx')
    msg.attach(part)

    #Attach Image
    fp = open('logo-1.png', 'rb')
    msgImage = MIMEImage(fp.read())
    fp.close()
    msgImage.add_header('Content-ID', 'logo')
    msg.attach(msgImage)

    fp = open('mail-2.jpg', 'rb')
    msgImage = MIMEImage(fp.read())
    fp.close()
    msgImage.add_header('Content-ID', 'mail')
    msg.attach(msgImage)

    fp = open('vwsmall.png', 'rb')
    msgImage = MIMEImage(fp.read())
    fp.close()
    msgImage.add_header('Content-ID', 'mini')
    msg.attach(msgImage)
   
    try:
        print("trying host and port...")
        #smtpObj = smtplib.SMTP_SSL('mail.dsec.ru', 465)	
        smtpObj = smtplib.SMTP('mx2.vwfsag.de', 25)
        #smtpObj.login("socialspam@dsec.ru", "sooc=i9W")
        smtpObj.set_debuglevel(1)
        print("sending mail...")
        smtpObj.sendmail(sender, recipients[a], msg.as_string())
        print(msg.as_string())
        print("Succesfully sent email")	
    	
    		
    	

    except smtplib.SMTPException:
        print("Error: unable to send email")
        import traceback
        traceback.print_exc()
    a+=1
