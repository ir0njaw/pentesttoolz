# -*- coding: utf-8 -*-
import smtplib
import datetime

from email import Utils
from email.header import Header
from email.mime.multipart import MIMEMultipart
from email.mime.application import MIMEApplication
from email.mime.text import MIMEText
from email.MIMEImage import MIMEImage


sender = 'youemail@gmail.com'
#receiver = 'ivanesense.frame@gmail.com'
#recipients = ['ivanesense.frame@gmail.com', 'nikita.elkey@gmail.com', 'lukesparamore@gmail.com'] #################
recipients = ['x'] 
#recipients = ['ivanesense@list.ru'] 
subject = "DSecRG test"
fio=['Алексей','Никита','Егор']

a=0

while a<=0:
    msg = MIMEMultipart('related')
    msg['From'] = sender
    #msg['To'] = receiver
    msg['To'] = recipients[a]
    msg['Date']     = Utils.formatdate(localtime = 1)
    msg['Subject'] = Header("Subject", "utf-8")
    msg['Message-ID'] = Utils.make_msgid()


    # TEXT_RU
    
    text = u''+' ' ######################
    enc = MIMEText(text.encode('utf-8'), 'plain', 'UTF-8')
    msg.attach(enc)

    # TEXT
    part = MIMEText("")
    msg.attach(part)
    
    #HTML
    html = """<html>
    </html>""" 

    part2 = MIMEText(html, 'html', "utf-8")
    #part2.add_header('Content-Type: text/html; charset=windows-1251')
    msg.attach(part2)

    # ATTACH 
    part = MIMEApplication(open("D:\\smap\\"+str(a)+".docx","rb").read()) ##################################
    part.add_header('Content-Disposition', 'attachment', filename='new_reglament.docx')
    msg.attach(part)

    #Attach Image
    fp = open('logo-1.png', 'rb')
    msgImage = MIMEImage(fp.read())
    fp.close()
    msgImage.add_header('Content-ID', 'logo')
    msg.attach(msgImage)

    fp = open('mail-2.jpg', 'rb')
    msgImage = MIMEImage(fp.read())
    fp.close()
    msgImage.add_header('Content-ID', 'mail')
    msg.attach(msgImage)

    fp = open('vwsmall.png', 'rb')
    msgImage = MIMEImage(fp.read())
    fp.close()
    msgImage.add_header('Content-ID', 'mini')
    msg.attach(msgImage)
   
    try:
        print("trying host and port...")
        #smtpObj = smtplib.SMTP_SSL('mail.dsec.ru', 465)	
        smtpObj = smtplib.SMTP('mx2.xxx.de', 25)
        #smtpObj.login("socialspam@dsec.ru", "sooc=i9W")
        smtpObj.set_debuglevel(1)
        print("sending mail...")
        smtpObj.sendmail(sender, recipients[a], msg.as_string())
        print(msg.as_string())
        print("Succesfully sent email")	
    	
    		
    	

    except smtplib.SMTPException:
        print("Error: unable to send email")
        import traceback
        traceback.print_exc()
    a+=1
