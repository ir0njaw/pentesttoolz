# -*- coding: utf-8 -*-
import smtplib
import datetime
import random
from email.mime.multipart import MIMEMultipart
from email.mime.application import MIMEApplication
from email.mime.text import MIMEText
from email.MIMEImage import MIMEImage

def randstring(length=10):
    valid_letters='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
    return ''.join((random.choice(valid_letters) for i in xrange(length)))



sender = 'admin@dsec.ru'
receiver = 'lyk-lg@yandex.ru'
subject = "DSecRG test"

msg = MIMEMultipart('related')
msg['From'] = sender
msg['To'] = receiver
msg['Date'] = "Thu, 17 Jul 2014 13:09:41"
msg['Subject'] = subject
msg['Message-Id'] = randstring()+"@mx1.office"



# TEXT
part = MIMEText("Render this fucking image!")

msg.attach(part)

html = """<img alt="Render this fucking image!" src="cid:kokoko">
""" 
part2 = MIMEText(html, 'html')
#part2.add_header('Content-Type: text/html; charset=windows-1251')
msg.attach(part2)
# This example assumes the image is in the current directory
fp = open('1.jpg', 'rb')
msgImage = MIMEImage(fp.read())
fp.close()
# Define the image's ID as referenced above
msgImage.add_header('Content-ID', 'kokoko')
msg.attach(msgImage)


try:
    print("trying host and port...")
    smtpObj = smtplib.SMTP_SSL('mail.dsec.ru', 465)	
    smtpObj.login("socialspam@dsec.ru", "sooc=i9W")
   
    #smtpObj = smtplib.SMTP('gmail-smtp-in.l.google.com', 25)
    print("sending mail...")
    smtpObj.sendmail(sender, receiver, msg.as_string())
    smtpObj.quit()
    print(msg.as_string())
    print("Succesfully sent email")	
	
		
	

except smtplib.SMTPException:
    print("Error: unable to send email")
    import traceback
    traceback.print_exc()